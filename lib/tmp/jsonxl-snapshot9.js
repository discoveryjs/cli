var ot=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ce=Object.prototype.hasOwnProperty;var fe=(e,t)=>{for(var s in t)ot(e,s,{get:t[s],enumerable:!0})},ae=(e,t,s,f)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of oe(t))!ce.call(e,a)&&a!==s&&ot(e,a,{get:()=>t[a],enumerable:!(f=ie(t,a))||f.enumerable});return e};var le=e=>ae(ot({},"__esModule",{value:!0}),e);var we={};fe(we,{Writer:()=>H,createWriterBackend:()=>it,encode:()=>se,isHeaderAcceptable:()=>ne,isVersionSupported:()=>pt,parseHeader:()=>At});module.exports=le(we);var et=new Uint8Array([0,0,74,83,79,78,88,76]),K=9,bt=255,Et=65535,gt=16777215,rt=268435455,wt=1073741823;var z=4294967295,yt=-127,Rt=127,Ut=-32767,kt=32767,Ot=-8388607,Mt=8388607,mt=-2147483647,Ct=2147483647,St=127,Vt=16383,Yt=2097151,C=0,Dt=1,Q=2,M=4,G=8,b=16,ct=32,ft=64,S=128,x=0,E=1,j=2,v=3,X=4,W=5,J=6;var V=8,Y=9,D=10,B=11,L=12,Bt=31,Z=224,at=7936,g=0,T=1,w=2,y=3,R=4,U=5,F=6,q=7,st=8,Lt=0,nt=16,lt=32,Pt=~b,Re=Q|ct|ft,m=new Uint8Array(256).map((e,t)=>{for(let s=0;s<8;s++)e+=t>>s&1;return e});var Ft=65536,_t=new Uint32Array(16),ht=_t.subarray(0,8),Gt=_t.subarray(8,16);function Nt(e){return Math.fround(e)===e?W:J}function It(e){return e<0?e<Ut?e<Ot?e<mt?L:B:D:e<yt?Y:V:e>kt?e>Mt?e>Ct?L:B:D:e>Rt?Y:V}function qt(e){return e>Et?e>gt?e>z?X:v:j:e>bt?E:x}function dt(e){return Number.isInteger(e)?e<0?It(e):qt(e):Nt(e)}function he(e){return Number.isInteger(e)?It(e):Nt(e)}function jt(e,t){let s=Math.max(Math.abs(e),Math.abs(t)),f=e<0?1:0;return Math.max(32-Math.clz32(s)+f,1)}function _e(e,t,s,f){switch(f){case x:t[g]+=1,t[w]+=s>127?2:1,t[R]+=s>7?1:0;break;case E:t[g]+=2,t[w]+=s>16383?3:2,t[R]+=s>1023?2:1;break;case j:t[g]+=3,t[w]+=s>2097151?4:3,t[R]+=s>131071?3:2;break;case v:t[g]+=4,t[w]+=s>268435455?5:4,t[R]+=s>16777215?4:3;break;case X:{let a=e.vlqBytesNeeded(s);t[g]+=a,t[w]+=a,t[R]+=e.vlqBytesNeeded((s-(s&7))/8);break}}}function Ne(e,t,s,f){switch(s<0&&(s=-s),f){case V:{t[T]+=1,t[y]+=s>63?2:1,t[U]+=s>3?1:0;break}case Y:{t[T]+=2,t[y]+=s>8191?3:2,t[U]+=s>511?2:1;break}case D:{t[T]+=3,t[y]+=s>1048575?4:3,t[U]+=s>65535?3:2;break}case B:{t[T]+=4,t[y]+=s>134217727?5:4,t[U]+=s>8388607?4:3;break}case L:{let a=2*s,r=e.vlqBytesNeeded(a);t[T]+=r,t[y]+=r,t[U]+=e.vlqBytesNeeded((a-(a&7))/8);break}}}function vt(e,t,s){let f=It(s);if(Ne(e,t,s,f),s>=0){let a=qt(s);return _e(e,t,s,a),1<<f|1<<a}return 1<<f|Ft}function Ht(e,t,s,f){let a=s&Ft,r=a?T:g,c=a?(s>>8|s&Z)&255:s&(Bt|Z),n=m[c],i=t[r]+(n>1?Math.ceil(e*(n<=2?1:n<=4?2:3)/8):0)+(f?2:0);return{encoding:c<<8|r,minBytes:i}}function Xt(e,t,s,f,a,r){let c=r<=16?Math.ceil(e*r/8)+(f?2:0):1/0,{encoding:n,minBytes:i}=Ht(e,t,s,f);if((n&15)===T){let l=t[y]+(f?1:0),h=t[U]+Math.ceil(e/2)+(f?1:0);c<i&&(n=r<<8|q,i=c),l<i&&(n=y,i=l),h<i&&(n=U,i=h)}else{let l=t[w]+(f?1:0),h=t[R]+Math.ceil(e/2)+(f?1:0);c<i&&(n=r<<8|F,i=c),l<i&&(n=w,i=l),h<i&&(n=R,i=h)}return{encoding:n|a,minBytes:i}}function Ie(e,t,s=!0,f=0,a=t.length){let r=a-f,c=0,n=!1,i=t[f],o=t[f];_t.fill(0);for(let d=f;d<a;d++){let O=t[d];Number.isInteger(O)?c|=vt(e,ht,O):(c|=1<<Nt(O),n=!0),O<i&&(i=O),O>o&&(o=O)}if(n||r<2)return Ht(r,ht,c,s);let l=t[f+1]-t[f],h=l,_=l,I=0;for(let d=f;d<a;d++){let O=t[d];if(d!==f){let P=O-t[d-1];I|=vt(e,Gt,P),l!==P&&(l=!1),P>h&&(h=P),P<_&&(_=P)}}let{encoding:u,minBytes:p}=Xt(r,ht,c,s,Lt,jt(i,o)),k=Xt(r-1,Gt,I,s,nt,jt(_,h)),N=k.minBytes+e.intVarBytesNeeded(t[f]);if(N<p&&(u=k.encoding,p=N),r>2&&l!==!1){let d=e.intVarBytesNeeded(t[f])+e.intVarBytesNeeded(l)+(s?1:0);d<p&&(u=st,p=d)}return{encoding:u,minBytes:p}}function ut(e,t,s=!0){let{encoding:f}=Ie(e,t,s);return f}function de(e,t){switch(t&15){case g:case T:case F:case q:e.writeNumber(t,E);break;default:e.writeNumber(t,x)}}function A(e,t,s){if(s||e.writeVlq(t.length),t.length>0){let f=ut(e,t,!0);de(e,f),xt(e,t,f)}}function xt(e,t,s){let f=s&15,a=s&48,r=t;switch(a){case nt:{e.writeIntVar(r[0]),r=Array.from({length:t.length-1},(c,n)=>t[n+1]-t[n]);break}case lt:{let c=r[0];for(let n=1;n<r.length;n++)r[n]<c&&(c=r[n]);e.writeIntVar(c),r=Array.from(t,n=>n-c);break}}switch(f){case w:{for(let c=0;c<r.length;c++)e.writeVlq(r[c]);break}case y:{for(let c=0;c<r.length;c++)e.writeIntVar(r[c]);break}case R:{for(let c=0;c<r.length;c+=2)e.writeNumber((r[c]>7?8:0)|r[c]&7|(r[c+1]>7?128:0)|(r[c+1]&7)<<4,x);for(let c=0;c<r.length;c++)r[c]>7&&e.writeVlq((r[c]-(r[c]&7))/8);break}case U:{for(let c=0;c<r.length;c+=2){let n=r[c],i=Math.abs(n),o=r[c+1]||0,l=Math.abs(o);e.writeNumber((i>3?8:0)|i&3|(n<0?4:0)|(l>3?128:0)|(l&3|(o<0?4:0))<<4,x)}for(let c=0;c<r.length;c++){let n=r[c]>=0?r[c]:-r[c];n>3&&e.writeVlq((n-(n&3))/4)}break}case F:{let c=s>>8,n=0,i=0;for(let o=0;o<r.length;o++)i|=r[o]<<n,n+=c,n>=16&&(e.writeNumber(i,E),n-=16,i>>=16);n>8?e.writeNumber(i,E):n>0&&e.writeNumber(i,x);break}case q:{let c=s>>8,n=0,i=0;for(let o=0;o<r.length;o++){let l=r[o];i|=(l<0?-l<<1|1:l<<1)<<n,n+=c,n>=16&&(e.writeNumber(i,E),n-=16,i>>=16)}n>8?e.writeNumber(i,E):n>0&&e.writeNumber(i,x);break}case st:{e.writeIntVar(r[0]),e.writeIntVar(r[1]-r[0]);break}case g:case T:{let c=f===T,n=s>>8,i=c?s&at|n&Z:n;if(m[n]>1){let l=c?r.map(he):r.map(dt);e.writeTypeIndex(l,i,!1);for(let h=0;h<r.length;h++)e.writeNumber(r[h],l[h])}else{let l=31-Math.clz32(i);for(let h=0;h<r.length;h++)e.writeNumber(r[h],l)}break}default:throw new Error("Unknown numeric array encoding method:",f)}}function ue(e,t){let s=Math.min(e.length,t.length);if(s>=3){let f=0;for(;f<s&&e[f]===t[f];f++);if(f>=3)return f}return 0}function xe(e,t,s){let f=Math.min(e.length,t.length-s);if(f>=3){let a=0;for(;a<f&&e[e.length-1-a]===t[t.length-1-a];a++);if(a>=3)return-a}return 0}function Kt(e,t,s,f,a,r,c){let n="",i="";e.sort((o,l)=>t[o]<t[l]?-1:1);for(let o=0;o<e.length;o++){let l=c++,h=e[o],_=t[h],I=ue(i,_),u=xe(i,_,I)||_.length,p=I>0,k=u<0,N=p||k?_.slice(I,u):_;r[h]=l,s[l]=N.length<<2|p<<1|k<<0,n+=N,i=_,p&&f.push(I),k&&a.push(-u)}return n}function zt(e,t){let s=new Uint32Array(e.length),f=[],a=[],r=new Uint32Array(e.length),c=new Uint32Array(e.length),n=new Set,i="",o=0;for(let h=0;h<t.length;h++){let _=t[h];++r[_]===2&&n.add(_)}let l=new Uint32Array(n).sort((h,_)=>r[_]-r[h]);for(let h of[[0,127],[127,16383]])if(l.length>o){let _=l.subarray(h[0],h[1]);i+=Kt(_,e,s,f,a,c,o),o+=_.length;for(let I=0;I<_.length;I++)r[_[I]]=0}for(let h=0,_=0;h<r.length;h++)r[h]!==0&&(r[_++]=h);i+=Kt(r.subarray(0,r.length-o),e,s,f,a,c,o);for(let h=0;h<t.length;h++)t[h]=c[t[h]];return{strings:i,stringDefs:s,stringSlicesStart:f,stringSlicesEnd:a,stringRefs:t}}var Te=new TextEncoder;function it(e=65536){let t=()=>{r=[],s()},s=()=>{c=new Uint8Array(e),n=new DataView(c.buffer),i=0},f=()=>{r.push(c.subarray(0,i)),c=n=null},a=o=>{i+o>c.length&&(f(),s())},r=null,c=null,n=null,i=0;if(e<8)throw new Error("Chunk size can't be less than 8 bytes");return t(),{ensureCapacity:a,reset:t,emit(){f();let o=Buffer.concat(r);return r=null,o},get written(){return r!==null?r.reduce((o,l)=>o+l.byteLength,0)+i:0},get state(){let o=this.written;try{return c.slice(this.x,o)}finally{this.x=o}},get stateHex(){return[...this.state].map(o=>o.toString(16).padStart(2,0)).join(" ")},writeBytes(o){let l=0;for(;l<o.byteLength;){let h=o.byteLength-i,_=o.subarray(l,l+=h);o.set(_,i),i+=_.byteLength,l<o.byteLength&&(f(),s())}},writeString(o){let l=0;for(;l<o.length;){let{read:h,written:_}=Te.encodeInto(l>0?o.slice(l):o,i>0?c.subarray(i):c);l+=h,i+=_,l<o.length&&(f(),s())}},writeUint8(o){a(1),n.setUint8(i,o),i+=1},writeInt8(o){a(1),n.setInt8(i,o),i+=1},writeUint16(o){a(2),n.setUint16(i,o,!0),i+=2},writeInt16(o){a(2),n.setInt16(i,o,!0),i+=2},writeUint24(o){a(3),n.setUint16(i,o,!0),n.setUint8(i+2,o>>16),i+=3},writeInt24(o){a(3),n.setInt16(i,o,!0),n.setInt8(i+2,o>>16),i+=3},writeUint32(o){a(4),n.setUint32(i,o,!0),i+=4},writeInt32(o){a(4),n.setInt32(i,o,!0),i+=4},writeUint64(o){a(8),n.setBigUint64(i,BigInt(o),!0),i+=8},writeFloat32(o){a(4),n.setFloat32(i,o,!0),i+=4},writeFloat64(o){a(8),n.setFloat64(i,o,!0),i+=8}}}var Wt=new Uint8Array(33);for(let e=0;e<33;e++)Wt[32-e]=Math.ceil(e/7)||1;function Qt(e,t){let s=new Uint32Array(t.length),f=new Uint32Array(t.length).map((r,c)=>c),a=t.slice();for(let r=0;r<e.length;r++)s[e[r]]++;f.sort((r,c)=>s[c]-s[r]||r-c);for(let r=0;r<f.length;r++)s[f[r]]=r,t[r]=a[f[r]];for(let r=0;r<e.length;r++)e[r]=s[e[r]]}var H=class{constructor(t){this.backend=it(t),this.objectKeys=new Map,this.objectEntryDefs=[],this.arrayLengths=[],this.arrayHeaders=new Map,this.arrayHeaderRefs=[],this.strings=new Map,this.stringRefs=[]}emit(){let t=new Uint8Array(12),s=new DataView(t.buffer);t.set(et),s.setUint16(8,K,!0);let f=this.backend.emit();for(let h of this.objectKeys.keys())this.writeString(h);let{strings:a,stringDefs:r,stringSlicesStart:c,stringSlicesEnd:n,stringRefs:i}=zt([...this.strings.keys()],this.stringRefs);this.backend.reset(),this.writeVlq(Buffer.byteLength(a)),this.backend.writeString(a),A(this,r),A(this,c),A(this,n),A(this,i),A(this,this.arrayLengths);let o=[...this.arrayHeaders.keys()];Qt(this.arrayHeaderRefs,o),A(this,o),A(this,this.arrayHeaderRefs),this.writeVlq(this.objectEntryDefs.length),this.writeVlq(this.objectKeys.size);for(let h of this.objectEntryDefs){let _=[0,...h.keys()],I=h.refs;Qt(I,_),A(this,_),A(this,I)}let l=this.backend.emit();return Buffer.concat([t,l,f])}writeString(t){let s=this.strings.get(t);s===void 0&&this.strings.set(t,s=this.strings.size),this.stringRefs.push(s)}writeObjectEntryKey(t,s,f){let a=this.objectKeys.get(s);a===void 0&&this.objectKeys.set(s,a=this.objectKeys.size);let r=t>=this.objectEntryDefs.length?this.objectEntryDefs[t]=Object.assign(new Map,{refs:[]}):this.objectEntryDefs[t],c=a<<8|f,n=this.objectEntryDefs[t].get(c);n===void 0&&r.set(c,n=r.size+1),r.refs.push(n)}writeObjectEntriesEnd(t){t>=this.objectEntryDefs.length?this.objectEntryDefs[t]=Object.assign(new Map,{refs:[0]}):this.objectEntryDefs[t].refs.push(0)}writeTypeIndex(t,s,f){let a=0,r=0,c=0;for(;s>0;)s&1&&(a|=c++<<(r<<2)),r++,s>>=1;let n=32-Math.clz32(c-1),i=0,o=0;for(let l=0;l<t.length;l++){let h=f?31-Math.clz32(t[l]||1):t[l],_=a>>(h<<2)&15;o|=_<<i,i+=n,i>=8&&(this.backend.writeUint8(o),i-=8,o>>=8)}i>0&&this.backend.writeUint8(o)}writeArrayLength(t){this.arrayLengths.push(t)}writeArrayHeader(t,s,f,a,r){let n=(a|(t&Pt)<<1|f<<5|r<<9)<<16|s,i=this.arrayHeaders.get(n);i===void 0&&this.arrayHeaders.set(n,i=this.arrayHeaders.size),this.arrayHeaderRefs.push(i)}vlqBytesNeeded(t){let s=0;for(;t>rt;)t/=268435456,s+=4;return Wt[Math.clz32(t)]+s}writeVlq(t){if(t<=St)this.backend.writeUint8(t<<1|0);else if(t<=Vt)this.backend.writeUint16(t<<2|1);else if(t<=Yt)this.backend.writeUint24(t<<3|3);else{let s=t&rt;this.backend.writeUint32((t>s?2147483648:0)+(s<<3|7)),t>s&&this.writeUintVar((t-s)/(1<<28))}}writeUintVar(t){if(t<=127)this.backend.writeUint8(t&127);else if(t<=16383)this.backend.writeUint16(t<<1&32512|128|t&127);else if(t<=2097151)this.backend.writeUint24(t<<2&8323072|32768|t<<1&32512|128|t&127);else{let s=this.vlqBytesNeeded(t);this.backend.ensureCapacity(s);for(let f=0;f<s-1;f++)this.backend.writeUint8(128|t&127),t=t>z?(t-(t&127))/128:t>>>7;this.backend.writeUint8(t&127)}}intVarBytesNeeded(t){return this.vlqBytesNeeded(t<0?-2*t:2*t)}writeIntVar(t){let s=0;t<0&&(s=1,t=-t),t<=wt?t=t<<1|s:t=2*t+s,this.writeUintVar(t)}writeNumber(t,s){switch(s){case x:this.backend.writeUint8(t);break;case E:this.backend.writeUint16(t);break;case j:this.backend.writeUint24(t);break;case v:this.backend.writeUint32(t);break;case X:this.writeUintVar(t);break;case V:this.backend.writeInt8(t);break;case Y:this.backend.writeInt16(t);break;case D:this.backend.writeInt24(t);break;case B:this.backend.writeInt32(t);break;case L:this.writeIntVar(t);break;case W:this.backend.writeFloat32(t);break;case J:this.backend.writeFloat64(t);break;default:throw new Error("Unknown numeric type: "+s)}}};function Tt(e){return $(e)||Q}function $(e){switch(typeof e){default:return C;case"boolean":return e?ct:ft;case"string":return G;case"number":return Number.isFinite(e)?M:Q;case"object":return e===null?Q:Array.isArray(e)||ArrayBuffer.isView(e)?S:b}}function Jt(e,t){let s=0;for(let f=0;f<e.length;f++)e[f]===t&&s++;return s}var Zt=new Map,pe=Object.freeze({hasInlinedEntries:!1,columns:Zt}),Ae=Object.freeze({hasInlinedEntries:!0,columns:Zt});function $t(e,t,s){if(!(s&b))return pe;let f=s===b,a=f?e.length:Jt(t,b);if(a>1){let r=new Map,c=!1;for(let n=0,i=0;n<e.length;n++)if(f||t[n]===b){let o=e[n];for(let l of Object.keys(o)){let h=o[l],_=$(h);if(_===C)continue;let I=r.get(l);I===void 0&&r.set(l,I={key:l,typeBitmap:0,values:new Array(a),valueCount:0}),I.typeBitmap|=_,I.values[i]=h,I.valueCount++}i++}for(let n of r.values()){n.valueCount!==a&&(n.typeBitmap|=Dt);let i=m[n.typeBitmap];if(i===1)continue;let o=32-Math.clz32(i-1),h=2+Math.ceil(o*a/8),_=n.valueCount*(1+!c);h>_&&(c=!0,r.delete(n.key))}if(r.size>0)return{hasInlinedEntries:c,columns:r}}return Ae}var be=ee();function te(){be=ee()}function ee(){return new Proxy(Object.create(null),{get(e,t){return Object.hasOwn(e,t)?Reflect.get(...arguments):e[t]=0}})}var Ee=Object.hasOwnProperty,ge=new Map;function re(e){let t=$(e);return t===C?0:(t===M?dt(e):0)<<3|31-Math.clz32(t)}function se(e,t={}){function s(n,i=ge){let o=0;for(let l in n)if(Ee.call(n,l)&&!i.has(l)){let h=n[l],_=re(h);if(_===C)continue;r.writeObjectEntryKey(o,l,_),a(_,h),o++}r.writeObjectEntriesEnd(o)}function f(n,i=!1,o=0){if(n.length===0){r.writeArrayLength(0);return}let l=null,h=0,_=null;if(o===0)for(let N=0;N<n.length;N++)o|=Tt(n[N]);m[o]>1&&(l=n.map(Tt)),o&M&&(_=o===M?n:n.filter((N,d)=>l[d]===M),h=ut(r,_,!1));let{hasInlinedEntries:I,columns:u}=$t(n,l,o),p=u.size!==0,k=0;if(i||r.writeArrayLength(n.length),r.writeArrayHeader(o,h,p,I,k),m[o]>1&&r.writeTypeIndex(l,o,!0),o&G)for(let N=0;N<n.length;N++)(l===null||l[N]===G)&&r.writeString(n[N]);if(o&M&&xt(r,_,h),k){let N=o===S?n:n.filter(Array.isArray);A(r,N.map(d=>d.length),!0),f(N.flat())}else if(o&S)for(let N=0;N<n.length;N++)(l===null||l[N]===S)&&f(n[N]);if(p){r.writeVlq(u.size);for(let N of u.keys())r.writeString(N);for(let N of u.values())f(N.values,!0,N.typeBitmap)}if(I)for(let N=0;N<n.length;N++)(l===null||l[N]===b)&&s(n[N],u)}function a(n,i){switch(1<<(n&7)){case G:r.writeString(i);break;case M:r.writeNumber(i,n>>3);break;case b:s(i);break;case S:f(i);break}}let r=new H(t.chunkSize),c=re(e);return te(),r.writeNumber(c,x),a(c,e),r.emit()}var tt=12;function pt(e){return e===K||e===9}function ne(e){try{let{version:t}=At(e);if(pt(t))return!0;throw new Error(`Unsupported jsonxl version "${t}", expected "${K}"`)}catch{return!1}}function At(e){if(e.byteLength<tt)throw new Error(`Header length must be at least ${tt} bytes`);let t=new Uint8Array(e.buffer,e.byteOffset,tt);if(t.subarray(0,8).some((c,n)=>c!==et[n]))throw new Error("Bad magic number");let f=new DataView(t.buffer,t.byteOffset,tt),a=f.getUint16(8,!0),r=f.getUint16(10,!0);return{version:a,flags:r,headerSize:tt}}var er=new TextDecoder("utf8",{ignoreBOM:!0});
